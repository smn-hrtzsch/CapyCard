<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:CapyCard.ViewModels"
             xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="450" d:DesignHeight="600"
             x:Class="CapyCard.Views.LlmImportDialog"
             x:DataType="vm:ImportViewModel">

    <Border Background="{DynamicResource SurfaceBrush}"
            CornerRadius="28"
            Padding="24"
            Margin="24"
            VerticalAlignment="Center"
            HorizontalAlignment="Stretch"
            MaxWidth="500"
            BoxShadow="0 4 16 0 #40000000">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="16">
                <!-- Header -->
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Text="Via KI / Text importieren"
                               FontSize="20"
                               FontWeight="Bold"
                               Foreground="{DynamicResource TextControlForeground}"
                               Grid.Column="0"/>
                    <Button Command="{Binding CloseLlmImportCommand}"
                            Classes="icon"
                            Grid.Column="1">
                        <materialIcons:MaterialIcon Kind="Close" Width="20" Height="20" 
                                                   Foreground="{DynamicResource TextMutedBrush}"/>
                    </Button>
                </Grid>

                <!-- Anleitung -->
                <Border Background="{DynamicResource BadgeBackgroundBrush}"
                        CornerRadius="16"
                        Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="So funktioniert es:" FontWeight="Bold" Foreground="{DynamicResource TextControlForeground}"/>
                        <TextBlock Text="1. Öffne ChatGPT, Claude oder eine andere KI." FontSize="13" TextWrapping="Wrap"/>
                        <TextBlock Text="2. Kopiere den System-Prompt (unten) und sende ihn an die KI." FontSize="13" TextWrapping="Wrap"/>
                        <TextBlock Text="3. Gib der KI dein Material (PDF-Text, Notizen, Thema)." FontSize="13" TextWrapping="Wrap"/>
                        <TextBlock Text="4. Füge das generierte JSON hier ein." FontSize="13" TextWrapping="Wrap"/>
                        
                        <Button Command="{Binding CopyPromptCommand}"
                                Classes="secondary"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                Margin="0,8,0,0">
                            <Panel>
                                <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding !IsCopySuccess}">
                                    <materialIcons:MaterialIcon Kind="ContentCopy" Width="18" Height="18"/>
                                    <TextBlock Text="System-Prompt kopieren"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding IsCopySuccess}">
                                    <materialIcons:MaterialIcon Kind="Check" Width="18" Height="18"/>
                                    <TextBlock Text="Kopiert!"/>
                                </StackPanel>
                            </Panel>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Input Area -->
                <StackPanel Spacing="8">
                    <TextBlock Text="JSON-Text hier einfügen:" 
                               FontSize="14" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextControlForeground}"/>
                    <TextBox Text="{Binding ImportJsonText}"
                             AcceptsReturn="True"
                             Height="200"
                             Watermark="[{ 'front': '...', 'back': '...' }, ...]"
                             Classes="floating"
                             VerticalContentAlignment="Top"
                             TextWrapping="Wrap"/>
                </StackPanel>

                <!-- Error Message -->
                <Border Background="#40FF5252"
                        CornerRadius="8"
                        Padding="12"
                        IsVisible="{Binding HasError}">
                    <TextBlock Text="{Binding ErrorMessage}"
                               TextWrapping="Wrap"
                               Foreground="#FFFF5252"
                               FontSize="12"/>
                </Border>

                <TextBlock Text="Tipp: Importiere größere Mengen an Material lieber in kleineren Häppchen für bessere Qualität."
                           FontSize="11"
                           FontStyle="Italic"
                           TextWrapping="Wrap"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"/>

                <!-- Action Buttons -->
                <Grid ColumnDefinitions="*,*" Margin="0,8,0,0">
                    <Button Command="{Binding CloseLlmImportCommand}"
                            Classes="secondary"
                            Grid.Column="0"
                            Margin="0,0,4,0"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center">
                        <TextBlock Text="Abbrechen"/>
                    </Button>

                    <Button Command="{Binding AnalyzeTextCommand}"
                            Classes="primary"
                            Grid.Column="1"
                            Margin="4,0,0,0"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center">
                        <TextBlock Text="Analysieren"/>
                    </Button>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Border>
</UserControl>
