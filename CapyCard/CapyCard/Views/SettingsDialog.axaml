<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:CapyCard.ViewModels"
             xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="using:CapyCard.Converters"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="550"
             x:Class="CapyCard.Views.SettingsDialog"
             x:DataType="vm:SettingsViewModel"
             Background="#80000000"
             IsVisible="False">
             
    <Grid>
        <Grid.KeyBindings>
            <KeyBinding Gesture="Escape" Command="{Binding CancelCommand}"/>
            <KeyBinding Gesture="Enter" Command="{Binding SaveCommand}"/>
        </Grid.KeyBindings>

        <Border Background="{DynamicResource SurfaceBrush}"
                Padding="24"
                Margin="24"
                MaxWidth="450"
                VerticalAlignment="Center"
                HorizontalAlignment="Center"
                CornerRadius="28"
                BoxShadow="0 4 10 0 #40000000">
                
            <Grid RowDefinitions="Auto,*,Auto">
                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,16" ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0" 
                               Text="Einstellungen" 
                               FontSize="20" FontWeight="Bold"
                               VerticalAlignment="Center"
                               Foreground="{DynamicResource TextControlForeground}"/>
                               
                    <Button Grid.Column="1"
                            Classes="icon"
                            Command="{Binding CancelCommand}"
                            ToolTip.Tip="Schließen">
                        <materialIcons:MaterialIcon Kind="Close" Width="24" Height="24" Foreground="{DynamicResource TextControlForeground}"/>
                    </Button>
                </Grid>
    
                <!-- Content -->
                <ScrollViewer Grid.Row="1" MaxHeight="600" Padding="0,0,16,0">
                    <StackPanel Spacing="24">
                        
                        <!-- Color Selection -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="Farbschema" FontWeight="SemiBold" Foreground="{DynamicResource TextControlForeground}"/>
                            
                            <ItemsControl ItemsSource="{Binding ColorOptions}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="4"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Command="{Binding $parent[UserControl].DataContext.SetSelectedColorCommand}"
                                                CommandParameter="{Binding Name}"
                                                Padding="0"
                                                Margin="0,0,12,12"
                                                CornerRadius="22"
                                                Width="44"
                                                Height="44"
                                                Background="Transparent">
                                            <Button.Styles>
                                                <Style Selector="Button:pointerover /template/ ContentPresenter">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                </Style>
                                            </Button.Styles>
                                            <Panel>
                                                <!-- Selection Ring (Active) -->
                                                <Border Width="44" Height="44" CornerRadius="22"
                                                        BorderBrush="{DynamicResource TextControlForeground}"
                                                        BorderThickness="2"
                                                        IsVisible="{Binding IsSelected}"/>
                                                
                                                <!-- Color Circle -->
                                                <Border Width="34" Height="34" CornerRadius="17"
                                                        Background="{Binding PreviewBrush}"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"/>
                                                        
                                                 <!-- Selected Indicator -->
                                                <materialIcons:MaterialIcon Kind="Check" Width="20" Height="20" Foreground="White"
                                                                          IsVisible="{Binding IsSelected}"/>
                                            </Panel>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                         </StackPanel>
                        
                        <Separator Background="{DynamicResource DividerBrush}" Height="1"/>
    
                        <!-- Mode Selection -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Erscheinungsbild" FontWeight="SemiBold" Foreground="{DynamicResource TextControlForeground}"/>
                            <StackPanel Orientation="Horizontal" Spacing="16">
                                 <RadioButton GroupName="Mode" Content="System" 
                                              IsChecked="{Binding SelectedMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=System}"/>
                                 <RadioButton GroupName="Mode" Content="Hell" 
                                              IsChecked="{Binding SelectedMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Light}"/>
                                 <RadioButton GroupName="Mode" Content="Dunkel" 
                                              IsChecked="{Binding SelectedMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=Dark}"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <Separator Background="{DynamicResource DividerBrush}" Height="1"/>
    
                        <!-- Zen Mode -->
                        <StackPanel Spacing="8">
                             <ToggleSwitch IsChecked="{Binding IsZenMode}"
                                           OnContent="Zen-Modus Aktiv"
                                           OffContent="Zen-Modus Aus"
                                           Content="Ablenkungsfreies Lernen"/>
                             <TextBlock Text="Reduziert visuelle Ablenkungen." 
                                        FontSize="12" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
                        </StackPanel>
    
                        <Separator Background="{DynamicResource DividerBrush}" Height="1"/>
    
                        <!-- Editor Toolbar -->
                        <StackPanel Spacing="8">
                             <ToggleSwitch IsChecked="{Binding ShowEditorToolbar}"
                                           OnContent="Toolbar anzeigen"
                                           OffContent="Toolbar verbergen"
                                           Content="Editor Toolbar"/>
                             <TextBlock Text="Standardmäßig Formatierungsleiste im Editor anzeigen." 
                                        FontSize="12" Foreground="{DynamicResource TextMutedBrush}" TextWrapping="Wrap"/>
                        </StackPanel>
                    
                    </StackPanel>
                </ScrollViewer>
    
                <!-- Actions -->
                <Grid Grid.Row="2" ColumnDefinitions="*,*" Margin="0,24,0,0">
                    <Button Grid.Column="0"
                            Content="Abbrechen" 
                            Command="{Binding CancelCommand}"
                            Classes="secondary"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Margin="0,0,8,0"/>
                            
                    <Button Grid.Column="1"
                            Content="Speichern" 
                            Command="{Binding SaveCommand}"
                            Classes="primary"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Margin="8,0,0,0"/>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>