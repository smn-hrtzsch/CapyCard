<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="200"
             x:Class="CapyCard.Controls.RichTextEditor"
             x:Name="Root">
    
    <UserControl.Resources>
        <!-- Icons -->
        <StreamGeometry x:Key="IconBold">M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z</StreamGeometry>
        <StreamGeometry x:Key="IconItalic">M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z</StreamGeometry>
        <StreamGeometry x:Key="IconUnderline">M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z</StreamGeometry>
        <StreamGeometry x:Key="IconBulletList">M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z</StreamGeometry>
        <StreamGeometry x:Key="IconNumberList">M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z</StreamGeometry>
        <StreamGeometry x:Key="IconImage">M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z</StreamGeometry>
        <StreamGeometry x:Key="IconHighlight">M6 14l3 3v5h6v-5l3-3V9H6v5zm5-12h2v3h-2V2zm8.5 3.87l1.41 1.41-2.12 2.12-1.41-1.41 2.12-2.12zM3.91 5.87l1.41-1.41 2.12 2.12-1.41 1.41-2.12-2.12z</StreamGeometry>
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Toolbar Button Style -->
        <Style Selector="Button.toolbar-btn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        <Style Selector="Button.toolbar-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource TileHoverBrush}"/>
        </Style>
        <Style Selector="Button.toolbar-btn:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource TileSelectedBrush}"/>
        </Style>
        
        <!-- Separator Style -->
        <Style Selector="Border.toolbar-separator">
            <Setter Property="Width" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource DividerBrush}"/>
            <Setter Property="Margin" Value="4,4"/>
        </Style>
    </UserControl.Styles>
    
    <Border BorderBrush="{DynamicResource SurfaceBorderBrush}" 
            BorderThickness="1" 
            CornerRadius="4"
            Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
        <Grid RowDefinitions="Auto,*">
            <!-- Toolbar -->
            <Border Grid.Row="0" 
                    Background="{DynamicResource SurfaceBackgroundBrush}"
                    BorderBrush="{DynamicResource DividerBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="4">
                <StackPanel Orientation="Horizontal" Spacing="2">
                    <!-- Fett -->
                    <Button Classes="toolbar-btn" 
                            Click="OnBoldClick"
                            ToolTip.Tip="Fett (Strg+B)">
                        <PathIcon Data="{StaticResource IconBold}" 
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                    </Button>
                    
                    <!-- Kursiv -->
                    <Button Classes="toolbar-btn" 
                            Click="OnItalicClick"
                            ToolTip.Tip="Kursiv (Strg+I)">
                        <PathIcon Data="{StaticResource IconItalic}" 
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                    </Button>
                    
                    <!-- Unterstrichen -->
                    <Button Classes="toolbar-btn" 
                            Click="OnUnderlineClick"
                            ToolTip.Tip="Unterstrichen (Strg+U)">
                        <PathIcon Data="{StaticResource IconUnderline}" 
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                    </Button>
                    
                    <!-- Separator -->
                    <Border Classes="toolbar-separator"/>
                    
                    <!-- Stichpunkt-Liste -->
                    <Button Classes="toolbar-btn" 
                            Click="OnBulletListClick"
                            ToolTip.Tip="Stichpunkt-Liste">
                        <PathIcon Data="{StaticResource IconBulletList}" 
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                    </Button>
                    
                    <!-- Nummerierte Liste -->
                    <Button Classes="toolbar-btn" 
                            Click="OnNumberListClick"
                            ToolTip.Tip="Nummerierte Liste">
                        <PathIcon Data="{StaticResource IconNumberList}" 
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                    </Button>
                    
                    <!-- Separator -->
                    <Border Classes="toolbar-separator"/>
                    
                    <!-- Bild einfügen -->
                    <Button Classes="toolbar-btn" 
                            Click="OnImageClick"
                            ToolTip.Tip="Bild einfügen">
                        <PathIcon Data="{StaticResource IconImage}" 
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                    </Button>
                    
                    <!-- Separator -->
                    <Border Classes="toolbar-separator"/>
                    
                    <!-- Hervorheben/Markieren -->
                    <Button Classes="toolbar-btn" 
                            Click="OnHighlightClick"
                            ToolTip.Tip="Hervorheben (==Text==)">
                        <PathIcon Data="{StaticResource IconHighlight}" 
                                  Width="16" Height="16"
                                  Foreground="#FFC107"/>
                    </Button>
                </StackPanel>
            </Border>
            
            <!-- Text Editor -->
            <TextBox x:Name="Editor"
                     Grid.Row="1"
                     Text="{Binding Text, ElementName=Root, Mode=TwoWay}"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Watermark="{Binding Watermark, ElementName=Root}"
                     BorderThickness="0"
                     Padding="8"
                     MinHeight="100"
                     KeyDown="Editor_OnKeyDown"
                     TextChanged="Editor_OnTextChanged"/>
        </Grid>
    </Border>
</UserControl>
